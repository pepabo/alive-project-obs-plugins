{{ define "main" }}

<!-- ===== HERO ===== -->
<div class="page-hero-bg"></div>
<header class="page-hero">
  <div class="page-hero-inner">
    <h1 class="hero-title"><img src="{{ "assets/logo.svg" | relURL }}" alt="ストラボ" class="hero-title-img"></h1>
    <p class="hero-desc">
      配信画面をもっとおしゃれに、個性的にしたい方へ！<br>
      OBSのソースに適用するだけで使える素材をまとめました。
    </p>
  </div>
</header>

<!-- ===== SEARCH + TABS ===== -->
{{/* タグ一覧を収集 */}}
{{ $filters := where .Site.RegularPages "Section" "filters" }}
{{ $allTags := slice }}
{{ range $filters }}
  {{ with .Params.tags }}
    {{ range . }}
      {{ $allTags = $allTags | append . }}
    {{ end }}
  {{ end }}
{{ end }}
{{ $uniqueTags := $allTags | uniq }}

<section class="search-tabs-section">
  <div class="header__search">
    <svg class="header__search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <input type="text" id="search-input" class="header__search-input" placeholder="配信をもっと面白くするフィルターを探す">
  </div>
  {{ if gt (len $uniqueTags) 0 }}
  <div class="tabs">
    <div class="tab on" data-category="all">すべて</div>
    {{ range $uniqueTags }}
    <div class="tab" data-category="{{ . }}">{{ . }}</div>
    {{ end }}
  </div>
  {{ end }}
</section>

<!-- ===== MAIN ===== -->
<div class="page-main">

  <!-- Card grid -->
  <div class="card-grid">
    {{ range $filters }}
    <div class="card-wrap" data-tags="{{ delimit (.Params.tags | default slice) "," }}" data-title="{{ .Title }}" data-description="{{ .Description }}">
      <a href="{{ .RelPermalink }}" class="card">
        <div class="card-thumb">
          {{ $page := . }}
          {{ with .Params.thumbnail }}
          {{ $img := $page.Resources.GetMatch . }}
          {{ if $img }}
          <img src="{{ $img.RelPermalink }}" alt="{{ $page.Title }}" loading="lazy">
          {{ else }}
          <span class="card-thumb-ph">画像、動画エリア</span>
          {{ end }}
          {{ else }}
          <span class="card-thumb-ph">画像、動画エリア</span>
          {{ end }}
        </div>
        <div class="card-body">
          <div class="card-title">{{ .Title }}</div>
          {{ with .Description }}<div class="card-desc">{{ . }}</div>{{ end }}
        </div>
      </a>
    </div>
    {{ end }}
  </div>

</div>

<script>
// カード表示アニメーション（左上から順に下→上・フェードイン）
document.querySelectorAll('.card-grid .card-wrap').forEach(function(wrap, index) {
  wrap.style.animationDelay = (index * 0.06) + 's';
});

// 検索機能
document.getElementById('search-input').addEventListener('input', function() {
  var query = this.value.toLowerCase();
  document.querySelectorAll('.card-wrap').forEach(function(wrap) {
    var title = (wrap.getAttribute('data-title') || '').toLowerCase();
    var desc = (wrap.getAttribute('data-description') || '').toLowerCase();
    var tags = (wrap.getAttribute('data-tags') || '').toLowerCase();
    wrap.style.display = (title.includes(query) || desc.includes(query) || tags.includes(query)) ? '' : 'none';
  });
});

// カテゴリフィルター
document.querySelectorAll('.tab').forEach(function(tab) {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('on'); });
    this.classList.add('on');
    var category = this.getAttribute('data-category');
    document.querySelectorAll('.card-wrap').forEach(function(wrap) {
      if (category === 'all') {
        wrap.style.display = '';
      } else {
        var tags = (wrap.getAttribute('data-tags') || '').split(',');
        wrap.style.display = tags.includes(category) ? '' : 'none';
      }
    });
  });
});
</script>
{{ end }}
