{{ define "main" }}

<!-- ===== HERO ===== -->
<div class="page-hero-bg"></div>
<header class="page-hero">
  <div class="page-hero-inner">
    <h1 class="hero-title"><img src="{{ "assets/logo.svg" | relURL }}" alt="ストラボ" class="hero-title-img"></h1>
    <p class="hero-desc">
      配信画面をもっとおしゃれに、もっと個性的にしたい方へ！<br>
      OBSのソースに適用するだけで使える素材をまとめました。
    </p>
  </div>
</header>

<!-- ===== SEARCH + TABS ===== -->
{{/* タグ一覧を収集 */}}
{{ $filters := where .Site.RegularPages "Section" "filters" }}
{{ $allTags := slice }}
{{ range $filters }}
  {{ with .Params.tags }}
    {{ range . }}
      {{ $allTags = $allTags | append . }}
    {{ end }}
  {{ end }}
{{ end }}
{{ $uniqueTags := $allTags | uniq }}

<section class="search-tabs-section">
  <div class="header__search">
    <svg class="header__search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <input type="text" id="search-input" class="header__search-input" placeholder="モザイク, ドットを検索">
  </div>
  {{ if gt (len $uniqueTags) 0 }}
  <div class="tabs">
    <div class="tab on" data-category="all">すべて</div>
    {{ range $uniqueTags }}
    <div class="tab" data-category="{{ . }}">{{ . }}</div>
    {{ end }}
  </div>
  {{ end }}
</section>

<!-- ===== MAIN ===== -->
<div class="page-main">

  <!-- Card grid -->
  <div class="card-grid">
    {{ range $filters }}
    <a href="{{ .RelPermalink }}" class="card" data-tags="{{ delimit (.Params.tags | default slice) "," }}" data-title="{{ .Title }}" data-description="{{ .Description }}">
      <div class="card-thumb">
        {{ $page := . }}
        {{ with .Params.thumbnail }}
        {{ $img := $page.Resources.GetMatch . }}
        {{ if $img }}
        <img src="{{ $img.RelPermalink }}" alt="{{ $page.Title }}" loading="lazy">
        {{ else }}
        <span class="card-thumb-ph">画像、動画エリア</span>
        {{ end }}
        {{ else }}
        <span class="card-thumb-ph">画像、動画エリア</span>
        {{ end }}
      </div>
      <div class="card-body">
        <div class="card-title">{{ .Title }}</div>
        {{ with .Params.tags }}
        <div class="card-tags">
          {{ range . }}
          <span class="card-tag">{{ . }}</span>
          {{ end }}
        </div>
        {{ end }}
        {{ with .Description }}<div class="card-desc">{{ . }}</div>{{ end }}
      </div>
    </a>
    {{ end }}
  </div>

  <div class="footer__share">
    <p class="page-footer__share-title">SHARE</p>
    <div class="page-footer__share-list">
      <button type="button" class="share-btn-x" onclick="window.open('https://twitter.com/intent/tweet?url='+encodeURIComponent(location.href)+'&text='+encodeURIComponent(document.title),'_blank','noopener')">
        <img src="{{ "assets/x-circle-b.svg" | relURL }}" alt="Xでシェア" width="44" height="44">
      </button>
      <button type="button" class="share-btn-fb" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),'_blank','noopener')">
        <img src="{{ "assets/facebook.svg" | relURL }}" alt="Facebookでシェア" width="44" height="44">
      </button>
      <button type="button" class="share-btn-link" onclick="navigator.clipboard.writeText(location.href).then(function(){alert('リンクをコピーしました')})">
        <img src="{{ "assets/link-icon.svg" | relURL }}" alt="リンクをコピー" width="44" height="44">
      </button>
    </div>
  </div>

</div>

<script>
// カード表示アニメーション（左上から順に下→上・フェードイン）
document.querySelectorAll('.card-grid .card').forEach(function(card, index) {
  card.style.animationDelay = (index * 0.06) + 's';
});

// 検索機能
document.getElementById('search-input').addEventListener('input', function() {
  var query = this.value.toLowerCase();
  document.querySelectorAll('.card').forEach(function(card) {
    var title = (card.getAttribute('data-title') || '').toLowerCase();
    var desc = (card.getAttribute('data-description') || '').toLowerCase();
    var tags = (card.getAttribute('data-tags') || '').toLowerCase();
    card.style.display = (title.includes(query) || desc.includes(query) || tags.includes(query)) ? '' : 'none';
  });
});

// カテゴリフィルター
document.querySelectorAll('.tab').forEach(function(tab) {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('on'); });
    this.classList.add('on');
    var category = this.getAttribute('data-category');
    document.querySelectorAll('.card').forEach(function(card) {
      if (category === 'all') {
        card.style.display = '';
      } else {
        var tags = (card.getAttribute('data-tags') || '').split(',');
        card.style.display = tags.includes(category) ? '' : 'none';
      }
    });
  });
});
</script>
{{ end }}
