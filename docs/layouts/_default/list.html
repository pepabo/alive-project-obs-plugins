{{ define "main" }}

<!-- ===== HERO ===== -->
<div class="page-hero-bg"></div>
<header class="page-hero">
  <div class="page-hero-inner">
    <h1 class="hero-title"><img src="{{ "assets/logo.svg" | relURL }}" alt="ã‚¹ãƒˆãƒ©ãƒœ" class="hero-title-img"></h1>
    <p class="hero-desc">
      é…ä¿¡ç”»é¢ã‚’ã‚‚ã£ã¨ãŠã—ã‚ƒã‚Œã«ã€ã‚‚ã£ã¨å€‹æ€§çš„ã«ã—ãŸã„æ–¹ã¸ï¼<br>
      OBSã®ã‚½ãƒ¼ã‚¹ã«é©ç”¨ã™ã‚‹ã ã‘ã§ä½¿ãˆã‚‹ç´ æã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚
    </p>
  </div>
</header>

<!-- ===== SEARCH + TABS ===== -->
{{/* ã‚¿ã‚°ä¸€è¦§ã‚’åé›† */}}
{{ $filters := where .Site.RegularPages "Section" "filters" }}
{{ $allTags := slice }}
{{ range $filters }}
  {{ with .Params.tags }}
    {{ range . }}
      {{ $allTags = $allTags | append . }}
    {{ end }}
  {{ end }}
{{ end }}
{{ $uniqueTags := $allTags | uniq }}

<section class="search-tabs-section">
  <div class="header__search">
    <svg class="header__search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <input type="text" id="search-input" class="header__search-input" placeholder="ãƒ¢ã‚¶ã‚¤ã‚¯, ãƒ‰ãƒƒãƒˆã‚’æ¤œç´¢">
  </div>
  {{ if gt (len $uniqueTags) 0 }}
  <div class="tabs">
    <div class="tab on" data-category="all">ã™ã¹ã¦</div>
    {{ range $uniqueTags }}
    <div class="tab" data-category="{{ . }}">{{ . }}</div>
    {{ end }}
  </div>
  {{ end }}
</section>

<!-- ===== MAIN ===== -->
<div class="page-main">

  <!-- Card grid -->
  <div class="card-grid">
    {{ range $filters }}
    <a href="{{ .RelPermalink }}" class="card" data-tags="{{ delimit (.Params.tags | default slice) "," }}" data-title="{{ .Title }}" data-description="{{ .Description }}">
      <div class="card-thumb">
        {{ $page := . }}
        {{ with .Params.thumbnail }}
        {{ $img := $page.Resources.GetMatch . }}
        {{ if $img }}
        <img src="{{ $img.RelPermalink }}" alt="{{ $page.Title }}" loading="lazy">
        {{ else }}
        <span class="card-thumb-ph">ç”»åƒã€å‹•ç”»ã‚¨ãƒªã‚¢</span>
        {{ end }}
        {{ else }}
        <span class="card-thumb-ph">ç”»åƒã€å‹•ç”»ã‚¨ãƒªã‚¢</span>
        {{ end }}
      </div>
      <div class="card-body">
        <div class="card-title">{{ .Title }}</div>
        {{ with .Params.tags }}
        <div class="card-tags">
          {{ range . }}
          <span class="card-tag">{{ . }}</span>
          {{ end }}
        </div>
        {{ end }}
        {{ with .Description }}<div class="card-desc">{{ . }}</div>{{ end }}
      </div>
    </a>
    {{ end }}
  </div>

  <!-- SHARE -->
  <div class="share-section">
    <div class="share-label">SHARE</div>
    <div class="share-row">
      <a href="#" class="share-btn share-x">ğ• ãƒã‚¹ãƒˆ</a>
      <a href="#" class="share-btn share-fb">f ã‚·ã‚§ã‚¢</a>
      <a href="#" class="share-btn share-hb">B! ã¯ã¦ãƒ–</a>
      <a href="#" class="share-btn share-line">LINE ã§é€ã‚‹</a>
    </div>
  </div>

</div>

<script>
// ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå·¦ä¸Šã‹ã‚‰é †ã«ä¸‹â†’ä¸Šãƒ»ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ï¼‰
document.querySelectorAll('.card-grid .card').forEach(function(card, index) {
  card.style.animationDelay = (index * 0.06) + 's';
});

// æ¤œç´¢æ©Ÿèƒ½
document.getElementById('search-input').addEventListener('input', function() {
  var query = this.value.toLowerCase();
  document.querySelectorAll('.card').forEach(function(card) {
    var title = (card.getAttribute('data-title') || '').toLowerCase();
    var desc = (card.getAttribute('data-description') || '').toLowerCase();
    var tags = (card.getAttribute('data-tags') || '').toLowerCase();
    card.style.display = (title.includes(query) || desc.includes(query) || tags.includes(query)) ? '' : 'none';
  });
});

// ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
document.querySelectorAll('.tab').forEach(function(tab) {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('on'); });
    this.classList.add('on');
    var category = this.getAttribute('data-category');
    document.querySelectorAll('.card').forEach(function(card) {
      if (category === 'all') {
        card.style.display = '';
      } else {
        var tags = (card.getAttribute('data-tags') || '').split(',');
        card.style.display = tags.includes(category) ? '' : 'none';
      }
    });
  });
});
</script>
{{ end }}
