{{ define "main" }}
<article class="single-page">
  <div class="single-hero">
    <div class="single-title-bar">
      <h1 class="single-title">{{ .Title }}</h1>
      {{ with .Description }}
      <p class="single-description">{{ . }}</p>
      {{ end }}
      {{ with .Params.tags }}
      {{ end }}
    </div>
    {{ $page := . }}
    {{ with .Params.thumbnail }}
    {{ $img := $page.Resources.GetMatch . }}
    {{ if $img }}
    <div class="single-thumbnail">
      <img src="{{ $img.RelPermalink }}" alt="{{ $page.Title }}">
    </div>
    {{ end }}
    {{ end }}
  </div>

  {{ with .Params.download_url }}
  <div class="single-download">
    <a href="{{ . }}" class="download-btn" download>ダウンロード</a>
  </div>
  {{ end }}

  <div class="content" id="install" data-section="{{ .Section }}">
    {{ .Content }}
  </div>

  {{ if eq .Section "filters" }}
  <script>
  (function() {
    var content = document.getElementById('install');
    if (!content || content.getAttribute('data-section') !== 'filters') return;
    var firstH2 = content.querySelector('h2:first-of-type');
    if (!firstH2) return;
    var nodes = [];
    var el = firstH2;
    while (el) {
      if (el.tagName === 'H2' && nodes.length > 0) break;
      nodes.push(el);
      el = el.nextElementSibling;
    }
    if (nodes.length === 0) return;
    var wrap = document.createElement('div');
    wrap.className = 'preparation-block';
    nodes[0].parentNode.insertBefore(wrap, nodes[0]);
    nodes.forEach(function(n) { wrap.appendChild(n); });
  })();
  </script>
  {{ end }}

</article>
{{ end }}
